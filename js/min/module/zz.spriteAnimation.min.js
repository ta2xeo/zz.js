"use strict";zz.spriteAnimation=new function(){var a={LOAD_SPRITES:"__load_sprites__",ANIMATION_END:"__animation_end__"};var b="";function c(a){b=a;}function d(){zz.MovieClip.apply(this);this.setCommonPath("","");this.spriteLoaded=false;this.stop();this.loop=true;this.autoPlay=true;}d.prototype=zz.createClass(zz.MovieClip,{setCommonPath:function(a,c){this.prefix=b+a;this.suffix=c;},loadComplete:function(b){var c=this;function d(){++c.loadCount;if(c.loadCount===c.sprites.length){c.spritesLoaded=true;if(c.autoPlay)c.gotoAndPlay(c.currentFrame);else{var e=c.sprites[0];c.setSpriteSize(e);}c.spriteLoaded=true;c.dispatchEvent(a.LOAD_SPRITES);}b.removeEventListener(zz.Event.COMPLETE,d);}return d;},loadAnimation:function(a){if(!(a instanceof Array))a=Array.prototype.slice.call(arguments);this.sprites=[];this.loadCount=0;var b=a.length;for(var c=0;c<b;c++){var d=this.prefix+a[c]+this.suffix;var e=new zz.Sprite(d);e.visible=false;this.sprites.push(e);e.addEventListener(zz.Event.COMPLETE,this.loadComplete(e));this.addChild(e);}if(b>0)this.setAnimationInterval();},_changeSprite:function(a){return function(){for(var b=0,c=this.numChildren;b<c;b++)if(a===b){var d=this.getChildAt(b);this.setSpriteSize(d);d.visible=true;}else this.getChildAt(b).visible=false;};},setSpriteByIndex:function(b){function c(){this.removeEventListener(a.LOAD_SPRITES,c);var d=this.spritesIndices[b];if(!d)throw new zz.ZZError("invalid index.");this.setFrame(d);}if(this.spritesIndices)c.call(this);else this.addEventListener(a.LOAD_SPRITES,c);},setSpriteSize:function(a){if(a)zz.MovieClip.prototype.setSize.call(this,a.width,a.height);},setAnimationInterval:function(b){if(b)if(b instanceof Array){this.intervalFrames=[];var c=1;for(var d=0,e=b.length;d<e;d++){c=b[d]||c;this.intervalFrames.push(c);}}else this.intervalFrames=[b];else if(!this.intervalFrames)this.intervalFrames=[1];var f=this._getAnimationData();var g=Object.keys(f);if(g.length===0)return;var h=this.intervalFrames[this.intervalFrames.length-1];var i=Math.max.apply(null,g)+h-1;var j=f[i]&&f[i].event;f[i]={event:function(){if(typeof j=="function")j.call(this);if(!this.loop)this.stop();this.dispatchEvent(a.ANIMATION_END);}};this.setAnimation(f);},_getAnimationData:function(){var a={};this.spritesIndices=[];var b=1;var c=1;for(var d=0,e=this.numChildren;d<e;d++){this.spritesIndices.push(b);a[b]={event:this._changeSprite(d)};c=this.intervalFrames[d]||c;b+=c;}return a;}});function e(){d.apply(this);this.selectedSprites=null;}e.prototype=zz.createClass(d,{loadAnimation:function(a,b,c,d){this.chipWidth=b;this.chipHeight=c;this.chipCount=d;var e=this.prefix+a+this.suffix;var f=new zz.MovieClip(e);f.visible=false;this.loadCount=0;var g=this;f.addEventListener(zz.Event.COMPLETE,function(){g.setAnimationInterval();g.loadComplete(f)();f.visible=true;});this.sprites=[];this.sprites.push(f);this.addChild(f);},_getAnimationData:function(){var a={};var b=1;var c={};var d=1;var e=this.sprites[0];var f=e.width/this.chipWidth<<0;var g=e.height/this.chipHeight<<0;var h=0;for(var i=0;i<g;i++)for(var j=0;j<f;j++){if(this.selectedSprites===null||h in this.selectedSprites){c[d]={tx:j*this.chipWidth,ty:i*this.chipHeight,tw:this.chipWidth,th:this.chipHeight,stop:true};++d;}++h;}e.setAnimation(c);var k=1;this.spritesIndices=[];for(i=0;i<this.chipCount;i++){this.spritesIndices.push(b);a[b]={event:(function(){var a=i+1;return function(){e.setFrame(a);};})()};k=this.intervalFrames[i]||k;b+=k;}return a;},selectSprites:function(a){this.selectedSprites={};for(var b=0,c=a.length;b<c;b++)this.selectedSprites[a[b]]=1;},setSpriteSize:function(a){if(a)zz.MovieClip.prototype.setSize.call(this,this.chipWidth,this.chipHeight);}});return zz.modularize({local:{setImagePath:c},global:{SpriteEvent:a,SpriteAnimation:d,SpriteSheetAnimation:e}});}();